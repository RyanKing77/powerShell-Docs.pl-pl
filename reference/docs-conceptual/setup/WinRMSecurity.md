---
ms.date: 2017-06-05
keywords: polecenia cmdlet programu PowerShell
title: WinRMSecurity
ms.openlocfilehash: 0522844fded847a3fd45c1b3890a141357edb2b2
ms.sourcegitcommit: 99227f62dcf827354770eb2c3e95c5cf6a3118b4
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/15/2018
---
# <a name="powershell-remoting-security-considerations"></a><span data-ttu-id="d769c-103">Zagadnienia dotyczące zabezpieczeń usługi zdalne środowiska PowerShell</span><span class="sxs-lookup"><span data-stu-id="d769c-103">PowerShell Remoting Security Considerations</span></span>

<span data-ttu-id="d769c-104">Usługi zdalne środowiska PowerShell jest zalecanym sposobem zarządzania komputerami z systemem Windows.</span><span class="sxs-lookup"><span data-stu-id="d769c-104">PowerShell Remoting is the recommended way to manage Windows systems.</span></span> <span data-ttu-id="d769c-105">Usługi zdalne środowiska PowerShell jest domyślnie włączone w systemie Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="d769c-105">PowerShell Remoting is enabled by default in Windows Server 2012 R2.</span></span> <span data-ttu-id="d769c-106">W tym dokumencie opisano problemy z zabezpieczeniami, zalecenia i najlepsze rozwiązania w przypadku korzystania z usługi zdalne środowiska PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d769c-106">This document covers security concerns, recommendations, and best practices when using PowerShell Remoting.</span></span>

## <a name="what-is-powershell-remoting"></a><span data-ttu-id="d769c-107">Co to jest obsługę zdalną środowiska PowerShell?</span><span class="sxs-lookup"><span data-stu-id="d769c-107">What is PowerShell Remoting?</span></span>

<span data-ttu-id="d769c-108">Korzysta z komunikacji zdalnej programu PowerShell [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), który jest przez firmę Microsoft implementacją [Web Services for Management (WS-Management)](http://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) protokołu, aby zezwolić użytkownikom na uruchamianie programu PowerShell poleceń na komputerach zdalnych.</span><span class="sxs-lookup"><span data-stu-id="d769c-108">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), which is the Microsoft implementation of the [Web Services for Management (WS-Management)](http://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) protocol, to allow users to run PowerShell commands on remote computers.</span></span> <span data-ttu-id="d769c-109">Można znaleźć więcej informacji o korzystaniu z usługi zdalne środowiska PowerShell w [uruchamiania poleceń zdalnych](https://technet.microsoft.com/library/dd819505.aspx).</span><span class="sxs-lookup"><span data-stu-id="d769c-109">You can find more information about using PowerShell Remoting at [Running Remote Commands](https://technet.microsoft.com/library/dd819505.aspx).</span></span>

<span data-ttu-id="d769c-110">Usługi zdalne środowiska PowerShell nie jest taka sama, jak za pomocą **ComputerName** parametru polecenia cmdlet, aby uruchomić go na komputerze zdalnym, który używa zdalnego wywoływania procedur (RPC), jako jego podstawowy protokół.</span><span class="sxs-lookup"><span data-stu-id="d769c-110">PowerShell Remoting is not the same as using the **ComputerName** parameter of a cmdlet to run it on a remote computer, which uses Remote Procedure Call (RPC) as its underlying protocol.</span></span>

## <a name="powershell-remoting-default-settings"></a><span data-ttu-id="d769c-111">Ustawienia domyślne obsługę zdalną środowiska PowerShell</span><span class="sxs-lookup"><span data-stu-id="d769c-111">PowerShell Remoting default settings</span></span>

<span data-ttu-id="d769c-112">Usługi zdalne środowiska PowerShell (i WinRM) nasłuchiwania następujące porty:</span><span class="sxs-lookup"><span data-stu-id="d769c-112">PowerShell Remoting (and WinRM) listen on the following ports:</span></span>

- <span data-ttu-id="d769c-113">HTTP: 5985</span><span class="sxs-lookup"><span data-stu-id="d769c-113">HTTP: 5985</span></span>
- <span data-ttu-id="d769c-114">HTTPS: 5986</span><span class="sxs-lookup"><span data-stu-id="d769c-114">HTTPS: 5986</span></span>

<span data-ttu-id="d769c-115">Domyślnie usługi zdalne środowiska PowerShell tylko zezwala na połączenia z członkami grupy Administratorzy.</span><span class="sxs-lookup"><span data-stu-id="d769c-115">By default, PowerShell Remoting only allows connections from members of the Administrators group.</span></span> <span data-ttu-id="d769c-116">Sesje będą uruchamiane w kontekście użytkownika, dzięki czemu wszystkie formanty dostępu do systemu operacyjnego stosowane do poszczególnych użytkowników i grup nadal stosuje się do nich nawiązaniu połączenia za pośrednictwem usługi zdalne środowiska PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d769c-116">Sessions are launched under the user's context, so all operating system access controls applied to individual users and groups continue to apply to them while connected over PowerShell Remoting.</span></span>

<span data-ttu-id="d769c-117">W sieciach prywatnych domyślne reguły zapory systemu Windows dla niego komunikację zdalną środowiska PowerShell akceptuje wszystkie połączenia.</span><span class="sxs-lookup"><span data-stu-id="d769c-117">On private networks, the default Windows Firewall rule for PowerShell Remoting accepts all connections.</span></span> <span data-ttu-id="d769c-118">W sieciach publicznych domyślna reguła zapory systemu Windows umożliwia obsługę zdalną środowiska PowerShell połączenia tylko z tej samej podsieci.</span><span class="sxs-lookup"><span data-stu-id="d769c-118">On public networks, the default Windows Firewall rule allows PowerShell Remoting connections only from within the same subnet.</span></span> <span data-ttu-id="d769c-119">Należy jawnie zmienić tej reguły, aby otworzyć komunikacji zdalnej programu PowerShell do wszystkich połączeń w sieci publicznej.</span><span class="sxs-lookup"><span data-stu-id="d769c-119">You have to explicitly change that rule to open PowerShell Remoting to all connections on a public network.</span></span>

><span data-ttu-id="d769c-120">**Ostrzeżenie:** reguły zapory dla sieci publicznych mają na celu ochronę komputera przed atakami połączenie zewnętrzne mogą okazać się złośliwe.</span><span class="sxs-lookup"><span data-stu-id="d769c-120">**Warning:** The firewall rule for public networks is meant to protect the computer from potentially malicious external connection attempts.</span></span> <span data-ttu-id="d769c-121">Należy zachować ostrożność podczas usuwania tej reguły.</span><span class="sxs-lookup"><span data-stu-id="d769c-121">Use caution when removing this rule.</span></span>

## <a name="process-isolation"></a><span data-ttu-id="d769c-122">Izolacja procesu</span><span class="sxs-lookup"><span data-stu-id="d769c-122">Process isolation</span></span>

<span data-ttu-id="d769c-123">Korzysta z komunikacji zdalnej programu PowerShell [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) do komunikacji między komputerami.</span><span class="sxs-lookup"><span data-stu-id="d769c-123">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) for communication between computers.</span></span> <span data-ttu-id="d769c-124">Usługa WinRM działa jako usługa na koncie Usługa sieciowa, a spowoduje utworzenie procesach izolowanych uruchomione jako konta użytkowników do hosta programu PowerShell wystąpień.</span><span class="sxs-lookup"><span data-stu-id="d769c-124">WinRM runs as a service under the Network Service account, and spawns isolated processes running as user accounts to host PowerShell instances.</span></span> <span data-ttu-id="d769c-125">Wystąpienie programu PowerShell uruchomione jako jeden użytkownik nie ma dostępu do procesu uruchomionego wystąpienia programu PowerShell jako inny użytkownik.</span><span class="sxs-lookup"><span data-stu-id="d769c-125">An instance of PowerShell running as one user has no access to a process running an instance of PowerShell as another user.</span></span>

## <a name="event-logs-generated-by-powershell-remoting"></a><span data-ttu-id="d769c-126">Dzienniki zdarzeń generowanych przez usługi zdalne środowiska PowerShell</span><span class="sxs-lookup"><span data-stu-id="d769c-126">Event logs generated by PowerShell Remoting</span></span>

<span data-ttu-id="d769c-127">FireEye udostępnił dobrej podsumowanie dzienniki zdarzeń i inne dowodów zabezpieczeń wygenerowane przez sesje komunikacji zdalnej programu PowerShell, dostępne pod adresem</span><span class="sxs-lookup"><span data-stu-id="d769c-127">FireEye has provided a good summary of the event logs and other security evidence generated by PowerShell Remoting sessions, available at</span></span>  
<span data-ttu-id="d769c-128">[Badanie środowiska PowerShell ataków](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span><span class="sxs-lookup"><span data-stu-id="d769c-128">[Investigating PowerShell Attacks](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span></span>

## <a name="encryption-and-transport-protocols"></a><span data-ttu-id="d769c-129">Protokołów transportu i szyfrowania</span><span class="sxs-lookup"><span data-stu-id="d769c-129">Encryption and transport protocols</span></span>

<span data-ttu-id="d769c-130">Warto wziąć pod uwagę zabezpieczeń połączenia komunikacji zdalnej programu PowerShell z dwóch perspektyw: początkowe uwierzytelnianie i stałą łączność.</span><span class="sxs-lookup"><span data-stu-id="d769c-130">It is helpful to consider the security of a PowerShell Remoting connection from two perspectives: initial authentication, and ongoing communication.</span></span> 

<span data-ttu-id="d769c-131">Niezależnie od protokołu transportu używanego (HTTP lub HTTPS) usługi zdalne środowiska PowerShell zawsze szyfruje cała komunikacja po początkowego uwierzytelniania za pomocą klucza symetrycznego AES 256 sesji.</span><span class="sxs-lookup"><span data-stu-id="d769c-131">Regardless of the transport protocol used (HTTP or HTTPS), PowerShell Remoting always encrypts all communication after initial authentication with a per-session AES-256 symmetric key.</span></span>
    
### <a name="initial-authentication"></a><span data-ttu-id="d769c-132">Początkowe uwierzytelnianie</span><span class="sxs-lookup"><span data-stu-id="d769c-132">Initial authentication</span></span>

<span data-ttu-id="d769c-133">Uwierzytelnianie potwierdza tożsamość klienta do serwera — oraz w idealnym przypadku - serwera do klienta.</span><span class="sxs-lookup"><span data-stu-id="d769c-133">Authentication confirms the identity of the client to the server - and ideally - the server to the client.</span></span>
    
<span data-ttu-id="d769c-134">Gdy klient nawiąże połączenie z serwerem domeny przy użyciu nazwy komputera (np.: serwer01, lub server01.contoso.com), jest domyślnym protokołem uwierzytelniania [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span><span class="sxs-lookup"><span data-stu-id="d769c-134">When a client connects to a domain server using its computer name (i.e.: server01, or server01.contoso.com), the default authentication protocol is [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span></span>
<span data-ttu-id="d769c-135">Kerberos gwarantuje tożsamość serwera i tożsamości użytkowników bez wysyłania dowolny rodzaj wielokrotnego poświadczenie.</span><span class="sxs-lookup"><span data-stu-id="d769c-135">Kerberos guarantees both the user identity and server identity without sending any sort of reusable credential.</span></span>

<span data-ttu-id="d769c-136">Gdy klient łączy się z serwerem domeny przy użyciu jego adresu IP lub łączy się z serwerem grupy roboczej, uwierzytelnianie Kerberos nie jest możliwe.</span><span class="sxs-lookup"><span data-stu-id="d769c-136">When a client connects to a domain server using its IP address, or connects to a workgroup server, Kerberos authentication is not possible.</span></span> <span data-ttu-id="d769c-137">W takim przypadku obsługę zdalną środowiska PowerShell zależy od [protokół uwierzytelniania NTLM](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span><span class="sxs-lookup"><span data-stu-id="d769c-137">In that case, PowerShell Remoting relies on the [NTLM authentication protocol](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span></span> <span data-ttu-id="d769c-138">Protokół uwierzytelniania NTLM gwarantuje tożsamość użytkownika bez wysyłania dowolny rodzaj możliwe poświadczeń.</span><span class="sxs-lookup"><span data-stu-id="d769c-138">The NTLM authentication protocol guarantees the user identity without sending any sort of delegable credential.</span></span> <span data-ttu-id="d769c-139">Do potwierdzenia tożsamości użytkownika, protokół NTLM wymaga, że klient i serwer obliczeniowe klucza sesji z hasła bez kiedykolwiek wymiana samego hasła.</span><span class="sxs-lookup"><span data-stu-id="d769c-139">To prove user identity, the NTLM protocol requires that both the client and server compute a session key from the user's password without ever exchanging the password itself.</span></span> <span data-ttu-id="d769c-140">Serwer zwykle nie zna hasło użytkownika, więc komunikuje się z kontrolerem domeny, które znać hasło użytkownika, a następnie oblicza klucza sesji dla serwera.</span><span class="sxs-lookup"><span data-stu-id="d769c-140">The server typically does not know the user's password, so it communicates with the domain controller, which does know the user's password and calculates the session key for the server.</span></span> 
      
<span data-ttu-id="d769c-141">Protokół NTLM, jednak gwarantuje tożsamość serwera.</span><span class="sxs-lookup"><span data-stu-id="d769c-141">The NTLM protocol does not, however, guarantee server identity.</span></span> <span data-ttu-id="d769c-142">Podobnie jak w przypadku wszystkich protokołów, który jest używany do uwierzytelniania NTLM, osoba atakująca z dostępem do konta komputera komputer przyłączony do domeny może wywołać kontrolera domeny w celu obliczania klucza sesji uwierzytelniania NTLM i tym samym podszyć się pod serwer.</span><span class="sxs-lookup"><span data-stu-id="d769c-142">As with all protocols that use NTLM for authentication, an attacker with access to a domain-joined computer's machine account could invoke the domain controller to compute an NTLM session-key and thereby impersonate the server.</span></span>

<span data-ttu-id="d769c-143">Uwierzytelnianie NTLM jest domyślnie wyłączona, ale może być dozwolony przez albo Konfigurowanie protokołu SSL na serwerze docelowym lub przez skonfigurowanie ustawienia WinRM TrustedHosts na komputerze klienckim.</span><span class="sxs-lookup"><span data-stu-id="d769c-143">NTLM-based authentication is disabled by default, but may be permitted by either configuring SSL on the target server, or by configuring the WinRM TrustedHosts setting on the client.</span></span>
    
#### <a name="using-ssl-certificates-to-validate-server-identity-during-ntlm-based-connections"></a><span data-ttu-id="d769c-144">Aby sprawdzić tożsamość serwera podczas połączenia oparte na protokole NTLM przy użyciu certyfikatów SSL</span><span class="sxs-lookup"><span data-stu-id="d769c-144">Using SSL certificates to validate server identity during NTLM-based connections</span></span>

<span data-ttu-id="d769c-145">Ponieważ protokół uwierzytelniania NTLM nie Sprawdź tożsamość serwera docelowego (tylko że on już zna hasło), można skonfigurować serwery docelowe, które używają protokołu SSL dla komunikacji zdalnej programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d769c-145">Since the NTLM authentication protocol cannot ensure the identity of the target server (only that it already knows your password), you can configure target servers to use SSL for PowerShell Remoting.</span></span> <span data-ttu-id="d769c-146">Przypisanie certyfikatu SSL na serwerze docelowym (jeśli wystawiony przez urząd certyfikacji, któremu ufa również klient) umożliwia uwierzytelnianie oparte na protokole NTLM, który gwarantuje tożsamość serwera i tożsamości użytkowników.</span><span class="sxs-lookup"><span data-stu-id="d769c-146">Assigning a SSL certificate to the target server (if issued by a Certificate Authority that the client also trusts) enables NTLM-based authentication that guarantees both the user identity and server identity.</span></span>
    
#### <a name="ignoring-ntlm-based-server-identity-errors"></a><span data-ttu-id="d769c-147">Ignorowanie błędów tożsamości serwera opartego na NTLM</span><span class="sxs-lookup"><span data-stu-id="d769c-147">Ignoring NTLM-based server identity errors</span></span>
      
<span data-ttu-id="d769c-148">W przypadku wdrażania certyfikatu SSL do serwera dla połączeń protokołu NTLM praktyce, może pominąć zwrócone błędy tożsamości przez dodanie serwera do usługi WinRM **TrustedHosts** listy.</span><span class="sxs-lookup"><span data-stu-id="d769c-148">If deploying a SSL certificate to a server for NTLM connections is infeasible, you may suppress the resulting identity errors by adding the server to the WinRM **TrustedHosts** list.</span></span> <span data-ttu-id="d769c-149">Należy pamiętać, że dodanie nazwę serwera do listy TrustedHosts nie należy traktować jako dowolnej formy instrukcji wiarygodności hostów, same — jak protokół uwierzytelniania NTLM nie może zagwarantować, że w rzeczywistości łączysz na hoście są ZAMIERZAJĄC nawiązać połączenie.</span><span class="sxs-lookup"><span data-stu-id="d769c-149">Please note that adding a server name to the TrustedHosts list should not be considered as any form of statement of the trustworthiness of the hosts themselves - as the NTLM authentication protocol cannot guarantee that you are in fact connecting to the host you are intending to connect to.</span></span>
<span data-ttu-id="d769c-150">Zamiast tego należy rozważyć ustawienie TrustedHosts listy hostów, dla których chcesz pominąć błędów wygenerowanych przez nie można zweryfikować tożsamości serwera.</span><span class="sxs-lookup"><span data-stu-id="d769c-150">Instead, you should consider the TrustedHosts setting to be the list of hosts for which you wish to suppress the error generated by being unable to verify the server's identity.</span></span>
    
    
### <a name="ongoing-communication"></a><span data-ttu-id="d769c-151">Stałe komunikacji</span><span class="sxs-lookup"><span data-stu-id="d769c-151">Ongoing Communication</span></span>

<span data-ttu-id="d769c-152">Po zakończeniu uwierzytelniania początkowego [protokołu komunikacji zdalnej programu PowerShell](https://msdn.microsoft.com/en-us/library/dd357801.aspx) szyfruje wszystkie stałą łączność z sesji klucza symetrycznego AES 256.</span><span class="sxs-lookup"><span data-stu-id="d769c-152">Once initial authentication is complete, the [PowerShell Remoting Protocol](https://msdn.microsoft.com/en-us/library/dd357801.aspx) encrypts all ongoing communication with a per-session AES-256 symmetric key.</span></span>  


## <a name="making-the-second-hop"></a><span data-ttu-id="d769c-153">Co drugi przeskok</span><span class="sxs-lookup"><span data-stu-id="d769c-153">Making the second hop</span></span>

<span data-ttu-id="d769c-154">Domyślnie usługi zdalne środowiska PowerShell użyje do uwierzytelniania NTLM lub Kerberos (jeśli jest dostępna).</span><span class="sxs-lookup"><span data-stu-id="d769c-154">By default, PowerShell Remoting uses Kerberos (if available) or NTLM for authentication.</span></span> <span data-ttu-id="d769c-155">Oba te protokoły uwierzytelniania komputer zdalny bez wysyłania poświadczeń do niego.</span><span class="sxs-lookup"><span data-stu-id="d769c-155">Both of these protocols authenticate to the remote machine without sending credentials to it.</span></span>
<span data-ttu-id="d769c-156">Jest to najbezpieczniejszy sposób uwierzytelniania, ale ponieważ komputer zdalny nie ma poświadczeń użytkownika, nie ma dostępu do innych komputerów i usług w imieniu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d769c-156">This is the most secure way to authenticate, but because the remote machine does not have the user's credentials, it cannot access other computers and services on the user's behalf.</span></span> <span data-ttu-id="d769c-157">Jest to nazywane "drugi problem przeskoku".</span><span class="sxs-lookup"><span data-stu-id="d769c-157">This is known as the "second hop problem".</span></span>

<span data-ttu-id="d769c-158">Istnieje kilka sposobów, aby uniknąć tego problemu.</span><span class="sxs-lookup"><span data-stu-id="d769c-158">There are several ways to avoid this problem.</span></span> <span data-ttu-id="d769c-159">Opisy tych metod i zalet i wad każdej zobacz [co drugi przeskok w komunikacji zdalnej programu PowerShell](PS-remoting-second-hop.md).</span><span class="sxs-lookup"><span data-stu-id="d769c-159">For descriptions of these methods, and the pros and cons of each, see [Making the second hop in PowerShell Remoting](PS-remoting-second-hop.md).</span></span>










